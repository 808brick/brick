<head>
</head>
<body>
  <h1> Test Application ROS </h1>  <br><br>
  <h3> Test Ros Subscriber</h3>
  <div id="html-topic-div"></div>
  <div id="test_image_div"></div>
<ul id="ul1">

</ul>

  <br><br>
  <button id="Refresh IPC">Refresh IPC</button>
  <br>
<!--   <iframe style="width:100%; height:400px;"  src="http://localhost:8080/stream?topic=/usb_cam/image_raw&type=ros_compressed"></iframe>
  <iframe style="width:100%; height:400px;"  src="http://localhost:8080/stream?topic=/usb_cam/image_raw&type=ros_compressed"></iframe> -->

  <button id="rostopic button">ROS topic list</button>
  <button id="roscore button">Start roscore</button>
  <button id="roscore stop">Stop roscore</button>
  <button id="start map server">Start Map Server</button>
  <button id="stop map server">Stop Map Server</button>
  <button id="ros launch">ROS Launch</button>
  <button id="ros launch debug">ROS Launch Debug</button>
  <button id="ros node kill">Kill all ROS Nodes</button>
  <button id="start video server">Start ROS Video Server</button>
  <button id="stop video server">Stop ROS Video Server</button>
  <!-- <button id="roslaunch list">ROS Launch List</button> -->
  <button id="ros source">Source ROS</button>

  <input type="file" id="input" onchange="handleFiles(this.files)" />
  <br/>
  <p id="launch_file_upload_p_tag" >Choose Launch File: </p>
  <img id="file_upload" src="folder.png"/>

  <br/><br/>
  <button id="roslaunch list">ROS Launch List</button>
  <p>Select A Launch File from Dropdown: </p>
  <select id="launch_file_dropdown">
    <option>Hit Ros Launch List Button ...</option>
  </select>
  <button id="ros launch dropdown button">Launch</button>

  <ul id="ul2">

</ul>
<div id="div1"></div>


</body>



<script>
	const electron = require('electron');
	const { ipcRenderer } = electron;

	const topic_div = document.getElementById('html-topic-div');
	// const todo_list = document.querySelector('ul');
	ul1 = document.getElementById('ul1');
	ul2 = document.getElementById('ul2');
	div1 = document.getElementById('div1');
	//Init IPC connection
	ipcRenderer.send('ipc_init', 'IPC Started');
	document.getElementById("Refresh IPC").onclick = function(){
		ipcRenderer.send('ipc_init', 'IPC Refreshed');
		console.log("IPC Refreshed");
	};
		document.getElementById("rostopic button").onclick = function(){
		ipcRenderer.send('rostopic_list', 'send_rostopics');
		console.log("ROS topics requested");
	};

	document.getElementById("roscore button").onclick = function(){
		ipcRenderer.send('roscore', 'start roscore');
		console.log("roscore start requested");
	};
	document.getElementById("roscore stop").onclick = function(){
		ipcRenderer.send('roscore_stop', 'start roscore');
		console.log("roscore stop requested");
	};
	document.getElementById("start map server").onclick = function(){
		ipcRenderer.send('map_server_start', 'start map server');
		console.log("map server start requested");
	};
	document.getElementById("stop map server").onclick = function(){
		ipcRenderer.send('map_server_stop', 'stop map server');
		console.log("map server stop requested");
	};
	document.getElementById("ros launch").onclick = function(){
		ipcRenderer.send('ros_launch', 'roslaunch file name');
		console.log("requesting to launch");
	};
	document.getElementById("ros launch debug").onclick = function(){
		ipcRenderer.send('ros_launch_debug', 'roslaunch file name debug');
		console.log("requesting to launch in debug mode");
	};
	document.getElementById("ros node kill").onclick = function(){
		ipcRenderer.send('ros_node_kill', 'kill all nodes');
		console.log("requesting to kill all ros nodes");
	};
	document.getElementById("start video server").onclick = function(){
		ipcRenderer.send('start_video_server', 'start video server');
		console.log("starting video server");
	};
	document.getElementById("stop video server").onclick = function(){
		ipcRenderer.send('stop_video_server', 'stop video server');
		console.log("stopping video server");
	};
	document.getElementById("roslaunch list").onclick = function(){
		ipcRenderer.send('roslaunch_list', 'list all launch files');
		console.log("requestign roslaunch list");
	};
	document.getElementById("ros source").onclick = function(){
		ipcRenderer.send('ros_source', 'source file');
		console.log("Sourcing Ros file: ____");
	};
	// document.getElementById('Refresh IPC').click();

	// const inputElement = document.getElementById("input");
	// inputElement.addEventListener("change", handleFiles, false);
	// function handleFiles() {
	//   const fileList = this.files; /* now you can work with the file list */
	//   console.log(fileList);
	// }
	document.getElementById("input").disabled = true;
	document.getElementById("launch_file_dropdown").disabled = true;

	document.getElementById("file_upload").onclick = function (){
		ipcRenderer.send('launch_file_upload', 'launch file');
		console.log("Request to launch file ...");
	}
	document.getElementById("ros launch dropdown button").onclick = function (){
		var dropdown_option = document.getElementById("launch_file_dropdown")
		var value = dropdown_option.options[dropdown_option.selectedIndex].value
		ipcRenderer.send('launch_file_from_dropdown', value);
		console.log("Request to launch file ..." + value);
	}

	ipcRenderer.on('rostopic_list', (event, received_info) => {
    	div1.innerHTML = received_info;
	});

	ipcRenderer.on('launch_file_upload', (event, received_info) => {
    	launch_file_upload_p_tag.innerHTML = "Choose Launch File: \t" + received_info;
	});

	ipcRenderer.on('roslaunch_list', (event, received_info) => {
    	launch_file_dropdown_element = document.getElementById('launch_file_dropdown');
    	launch_file_dropdown_element.disabled = false;
    	launch_file_dropdown_element.remove(0)
		for(var i = 0; i < received_info.length; i++) {
			var package_name = received_info[i][0];
			var launch_file_name = received_info[i][1]
		    var el = document.createElement("option");
		    el.textContent = package_name + " : " + launch_file_name;
		    el.value = package_name + " " + launch_file_name;
		    launch_file_dropdown_element.appendChild(el);
		}

	});
	
	ipcRenderer.on('test_ros_topic', (event, received_info) => {  
		ul1.innerHTML = received_info;
	});
</script>